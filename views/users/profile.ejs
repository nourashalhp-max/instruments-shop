<% title = 'Your Profile' %>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <h1 class="mb-5 text-center fw-bold">Your Profile</h1>

            <%- include('../partials/flash') %>

            <% if (user) { %>
                <div class="card shadow-lg mb-5">
                    <div class="card-header bg-dark text-white d-flex align-items-center">
                        <i class="fas fa-user-circle me-2" style="color: var(--bs-warning);"></i>
                        User Information
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-sm-4 fw-bold text-muted">Username:</div>
                            <div class="col-sm-8 fw-bold"><%= user.username %></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-4 fw-bold text-muted">Email:</div>
                            <div class="col-sm-8"><%= user.email %></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-4 fw-bold text-muted">Role:</div>
                            <div class="col-sm-8">
                                <span class="badge 
                                    <% if (user.role === 'admin') { %>bg-danger
                                    <% } else { %>bg-secondary
                                    <% } %>">
                                    <%= user.role %>
                                </span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-4 fw-bold text-muted">First Name:</div>
                            <div class="col-sm-8"><%= user.firstName || 'N/A' %></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-4 fw-bold text-muted">Last Name:</div>
                            <div class="col-sm-8"><%= user.lastName || 'N/A' %></div>
                        </div>
                        <hr>
                        <div class="row mb-2">
                            <div class="col-sm-4 fw-bold text-muted">Member Since:</div>
                            <div class="col-sm-8">
                                <% if (user.createdAt) { %>
                                    <%= new Date(user.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>
                                <% } else { %>
                                    <span class="text-danger">Date Missing</span>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card shadow-lg mb-5">
                    <div class="card-header bg-dark text-white d-flex align-items-center">
                        <i class="fas fa-shipping-fast me-2" style="color: var(--bs-warning);"></i>
                        Shipping Address
                    </div>
                    <div class="card-body">
                        <% if (user.shippingAddress && user.city && user.postalCode && user.country) { %>
                            <p class="mb-1 fw-bold"><%= user.firstName %> <%= user.lastName %></p>
                            <p class="mb-1"><%= user.shippingAddress %></p>
                            <p class="mb-1"><%= user.city %>, <%= user.postalCode %></p>
                            <p class="mb-0"><%= user.country %></p>
                        <% } else { %>
                            <p class="text-muted">No shipping address set. You can set it during checkout.</p>
                        <% } %>
                    </div>
                    <div class="card-footer text-end bg-light">
                        <a href="/profile/edit" class="btn btn-sm btn-outline-primary disabled" title="Feature not implemented yet">
                            <i class="fas fa-edit me-1"></i> Edit Address
                        </a>
                        <small class="text-muted ms-2">(Edit from checkout page for now)</small>
                    </div>
                </div>

                <div class="d-flex justify-content-center">
                    <a href="/orders" class="btn btn-primary btn-lg me-3 shadow-sm">
                        <i class="fas fa-receipt me-2"></i> My Orders
                    </a>
                    <a href="/logout" class="btn btn-danger btn-lg shadow-sm">
                        <i class="fas fa-sign-out-alt me-2"></i> Logout
                    </a>
                </div>
            <% } else { %>
                <div class="alert alert-danger text-center shadow" role="alert">
                    You are not logged in. Please <a href="/login" class="alert-link">log in</a> to view your profile.
                </div>
            <% } %>
        </div>
    </div>
</div>